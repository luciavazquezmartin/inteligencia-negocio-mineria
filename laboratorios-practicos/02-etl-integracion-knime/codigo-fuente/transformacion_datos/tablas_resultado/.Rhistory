adj = c(1, 0.5),
cex = 1.1,
font = 2,     # He puesto negrita (2) para que el color se vea mejor
col = colores_texto_finales) # <--- AQUÍ ESTÁ EL CAMBIO CLAVE
# 7. TEXTOS INFORMATIVOS
mtext("Validación de estructura con K=5 | Distancia Euclidea",
side = 1,
line = 15,
cex = 2.5,
col = "gray40",
font = 3)
legend("topleft",
legend = "Validación Estructural: K=5",
text.col = "#E74C3C",
cex = 2.5,
text.font = 2,
inset = c(0.01, 0),
bty = "n")
dev.off()
print(">>> Gráfico generado: Nombres coloreados según su Cluster K-Means real.")
# ----------------------------------------------------------------------------
# GRÁFICO 3: ANÁLISIS CENTRAL
# ----------------------------------------------------------------------------
print(">>> Generando Gráfico 3: Regresión Final...")
# 1. DEFINICIÓN DE COLORES (Tu mapa visual confirmado)
# C1=Morado, C2=Verde, C3=Rojo, C4=Gris, C5=Azul
colores_sincronizados <- c("#8E44AD", "#27AE60", "#E74C3C", "#34495E", "#3498DB")
# 2. ETIQUETAS DE LEYENDA (Ajustadas a tu análisis)
etiquetas_clusters <- c(
"C1: Occidente/Viejos (Alta Mort.)",
"C2: Jóvenes/Desarrollo (Baja Mort.)",
"C3: Bloque Mayoritario",
"C4: Ricos/Anglo (Impacto Medio)",
"C5: Outlier (Singapur)"
)
# 3. PAÍSES A DESTACAR (Selección estratégica para cubrir todo el gráfico)
paises_vip <- c(
# C1 (Morado): El epicentro
"Spain", "Italy", "Belgium", "Peru", "United Kingdom",
# C2 (Verde): El escudo joven
"Nigeria", "Tanzania", "Yemen", "Afghanistan",
# C3 (Rojo): Los grandes emergentes
"Brazil", "India", "Mexico",
# C4 (Gris): Comparativa de gestión (Estricto vs Laxo)
"United States", "Sweden", "Australia",
# C5 (Azul): El caso raro
"Singapore"
)
datos_vip <- datos_paises[datos_paises$Pais %in% paises_vip, ]
# 4. CALCULAR PENDIENTE
modelo <- lm(Muertes_Millon ~ Rigurosidad_Media, data = datos_paises)
pendiente <- round(coef(modelo)[2], 2)
# 5. GENERAR GRÁFICO
grafico_central <- ggplot(datos_paises, aes(x = Rigurosidad_Media, y = Muertes_Millon)) +
# Puntos
geom_point(aes(color = Grupo_Cluster), size = 4.5, alpha = 0.8) +
# Línea de tendencia
geom_smooth(method = "lm", se = TRUE, color = "#E67E22",
fill = "#E67E22", alpha = 0.15, linetype = "dashed", size = 1.2) +
# Etiquetas de países (ggrepel colocará las etiquetas para que no se pisen)
geom_text_repel(data = datos_vip,
aes(label = Pais),
size = 3.8, fontface = "bold", color = "#2C3E50",
box.padding = 0.6, max.overlaps = 50, point.padding = 0.3) +
# TUS COLORES Y NOMBRES
scale_color_manual(values = colores_sincronizados,
labels = etiquetas_clusters,
name = "Perfiles Demográficos") +
# NOTAS EXPLICATIVAS ACTUALIZADAS
annotate("text", x = min(datos_paises$Rigurosidad_Media),
y = max(datos_paises$Muertes_Millon),
label = paste0("Paradoja: Pendiente +", pendiente),
color = "#C0392B", size = 5, fontface = "bold", hjust = 0) +
annotate("label", x = 50, y = -500,
label = "CLAVES VISUALES:\n• Puntos MORADOS (C1): Arriba a la derecha. Alta mortalidad pese a medidas estrictas.\n• Puntos VERDES (C2): Abajo del todo. Mínima mortalidad por factor juventud.\n• Suecia vs USA (Gris): Misma mortalidad, pero estrategias opuestas.",
color = "gray20", size = 3.2, fontface = "italic", fill = "#ECF0F1", label.size = 0) +
# Títulos
labs(title = "¿Sirvió la 'Mano Dura'? Rigurosidad vs. Mortalidad",
subtitle = "Análisis de 150 países: La demografía fue más determinante que las restricciones",
x = "Índice de Rigurosidad Promedio (0-100)",
y = "Muertes Totales por Millón") +
theme_minimal(base_size = 14) +
theme(plot.title = element_text(face = "bold", size = 18, hjust = 0.5, color = "#2C3E50"),
plot.subtitle = element_text(size = 12, hjust = 0.5, color = "gray50"),
legend.position = "right",
legend.title = element_text(face = "bold"),
panel.grid.minor = element_blank())
ggsave("graficos_covid/03_analisis_central.png", grafico_central,
width = 15, height = 9, dpi = 300, bg = "white")
print(">>> Gráfico 3 generado. Colores: C1=Morado, C2=Verde.")
# ----------------------------------------------------------------------------
# GRÁFICO 3: ANÁLISIS CENTRAL
# ----------------------------------------------------------------------------
print(">>> Generando Gráfico 3: Regresión Final...")
# 1. DEFINICIÓN DE COLORES (Tu mapa visual confirmado)
# C1=Morado, C2=Verde, C3=Rojo, C4=Gris, C5=Azul
colores_sincronizados <- c("#8E44AD", "#27AE60", "#E74C3C", "#34495E", "#3498DB")
# 2. ETIQUETAS DE LEYENDA (Ajustadas a tu análisis)
etiquetas_clusters <- c(
"C1: Occidente/Viejos (Alta Mort.)",
"C2: Jóvenes/Desarrollo (Baja Mort.)",
"C3: Bloque Mayoritario",
"C4: Ricos/Anglo (Impacto Medio)",
"C5: Outlier (Singapur)"
)
# 3. PAÍSES A DESTACAR (Selección estratégica para cubrir todo el gráfico)
paises_vip <- c(
# C1 (Morado): El epicentro
"Spain", "Italy", "Belgium", "Peru", "United Kingdom",
# C2 (Verde): El escudo joven
"Nigeria", "Tanzania", "Yemen", "Afghanistan",
# C3 (Rojo): Los grandes emergentes
"Brazil", "India", "Mexico",
# C4 (Gris): Comparativa de gestión (Estricto vs Laxo)
"United States", "Sweden", "Australia",
# C5 (Azul): El caso raro
"Singapore"
)
datos_vip <- datos_paises[datos_paises$Pais %in% paises_vip, ]
# 4. CALCULAR PENDIENTE
modelo <- lm(Muertes_Millon ~ Rigurosidad_Media, data = datos_paises)
pendiente <- round(coef(modelo)[2], 2)
# 5. GENERAR GRÁFICO
grafico_central <- ggplot(datos_paises, aes(x = Rigurosidad_Media, y = Muertes_Millon)) +
# Puntos
geom_point(aes(color = Grupo_Cluster), size = 4.5, alpha = 0.8) +
# Línea de tendencia
geom_smooth(method = "lm", se = TRUE, color = "#E67E22",
fill = "#E67E22", alpha = 0.15, linetype = "dashed", size = 1.2) +
# Etiquetas de países (ggrepel colocará las etiquetas para que no se pisen)
geom_text_repel(data = datos_vip,
aes(label = Pais),
size = 3.8, fontface = "bold", color = "#2C3E50",
box.padding = 0.6, max.overlaps = 50, point.padding = 0.3) +
# TUS COLORES Y NOMBRES
scale_color_manual(values = colores_sincronizados,
labels = etiquetas_clusters,
name = "Perfiles Demográficos") +
# NOTAS EXPLICATIVAS ACTUALIZADAS
annotate("text", x = min(datos_paises$Rigurosidad_Media),
y = max(datos_paises$Muertes_Millon),
label = paste0("Paradoja: Pendiente +", pendiente),
color = "#C0392B", size = 5, fontface = "bold", hjust = 0) +
annotate("label", x = 50, y = -500,
label = "CLAVES VISUALES:\n• Puntos morados (C1): Zona central superior. Alta mortalidad pese a medidas relativamente estrictas.\n• Puntos verdes (C2): Zona inferior izquierda. Mínima mortalidad por factor juventud.\n• Suecia vs USA (Gris): Mortalidades similares, a pesar de estrategias opuestas.",
color = "gray20", size = 3.2, fontface = "italic", fill = "#ECF0F1", label.size = 0) +
# Títulos
labs(title = "¿Sirvió la 'Mano Dura'? Rigurosidad vs. Mortalidad",
subtitle = "Análisis de 150 países: La demografía fue más determinante que las restricciones",
x = "Índice de Rigurosidad Promedio (0-100)",
y = "Muertes Totales por Millón") +
theme_minimal(base_size = 14) +
theme(plot.title = element_text(face = "bold", size = 18, hjust = 0.5, color = "#2C3E50"),
plot.subtitle = element_text(size = 12, hjust = 0.5, color = "gray50"),
legend.position = "right",
legend.title = element_text(face = "bold"),
panel.grid.minor = element_blank())
ggsave("graficos_covid/03_analisis_central.png", grafico_central,
width = 15, height = 9, dpi = 300, bg = "white")
print(">>> Gráfico 3 generado. Colores: C1=Morado, C2=Verde.")
# ----------------------------------------------------------------------------
# GRÁFICO 3: ANÁLISIS CENTRAL
# ----------------------------------------------------------------------------
print(">>> Generando Gráfico 3: Regresión Final...")
# 1. DEFINICIÓN DE COLORES (Tu mapa visual confirmado)
# C1=Morado, C2=Verde, C3=Rojo, C4=Gris, C5=Azul
colores_sincronizados <- c("#8E44AD", "#27AE60", "#E74C3C", "#34495E", "#3498DB")
# 2. ETIQUETAS DE LEYENDA (Ajustadas a tu análisis)
etiquetas_clusters <- c(
"C1: Occidente/Viejos (Alta Mort.)",
"C2: Jóvenes/Desarrollo (Baja Mort.)",
"C3: Bloque Mayoritario",
"C4: Ricos/Anglo (Impacto Medio)",
"C5: Outlier (Singapur)"
)
# 3. PAÍSES A DESTACAR (Selección estratégica para cubrir todo el gráfico)
paises_vip <- c(
# C1 (Morado): El epicentro
"Spain", "Italy", "Belgium", "Peru", "United Kingdom",
# C2 (Verde): El escudo joven
"Nigeria", "Tanzania", "Yemen", "Afghanistan",
# C3 (Rojo): Los grandes emergentes
"Brazil", "India", "Mexico",
# C4 (Gris): Comparativa de gestión (Estricto vs Laxo)
"United States", "Sweden", "Australia",
# C5 (Azul): El caso raro
"Singapore"
)
datos_vip <- datos_paises[datos_paises$Pais %in% paises_vip, ]
# 4. CALCULAR PENDIENTE
modelo <- lm(Muertes_Millon ~ Rigurosidad_Media, data = datos_paises)
pendiente <- round(coef(modelo)[2], 2)
# 5. GENERAR GRÁFICO
grafico_central <- ggplot(datos_paises, aes(x = Rigurosidad_Media, y = Muertes_Millon)) +
# Puntos
geom_point(aes(color = Grupo_Cluster), size = 4.5, alpha = 0.8) +
# Línea de tendencia
geom_smooth(method = "lm", se = TRUE, color = "#E67E22",
fill = "#E67E22", alpha = 0.15, linetype = "dashed", size = 1.2) +
# Etiquetas de países (ggrepel colocará las etiquetas para que no se pisen)
geom_text_repel(data = datos_vip,
aes(label = Pais),
size = 3.8, fontface = "bold", color = "#2C3E50",
box.padding = 0.6, max.overlaps = 50, point.padding = 0.3) +
# TUS COLORES Y NOMBRES
scale_color_manual(values = colores_sincronizados,
labels = etiquetas_clusters,
name = "Perfiles Demográficos") +
# NOTAS EXPLICATIVAS ACTUALIZADAS
annotate("text", x = min(datos_paises$Rigurosidad_Media),
y = max(datos_paises$Muertes_Millon),
label = paste0("Paradoja: Pendiente +", pendiente),
color = "#C0392B", size = 5, fontface = "bold", hjust = 0) +
annotate("label", x = 50, y = -500,
label = "CLAVES VISUALES:\n• Puntos morados (C1): Zona central superior. Alta mortalidad pese a medidas relativamente estrictas.\n• Puntos verdes (C2): Zona inferior izquierda. Mínima mortalidad por factor juventud.\n• Sweden vs United States (Gris): Mortalidades similares, a pesar de estrategias opuestas.",
color = "gray20", size = 3.2, fontface = "italic", fill = "#ECF0F1", label.size = 0) +
# Títulos
labs(title = "¿Sirvió la 'Mano Dura'? Rigurosidad vs. Mortalidad",
subtitle = "Análisis de 150 países: La demografía fue más determinante que las restricciones",
x = "Índice de Rigurosidad Promedio (0-100)",
y = "Muertes Totales por Millón") +
theme_minimal(base_size = 14) +
theme(plot.title = element_text(face = "bold", size = 18, hjust = 0.5, color = "#2C3E50"),
plot.subtitle = element_text(size = 12, hjust = 0.5, color = "gray50"),
legend.position = "right",
legend.title = element_text(face = "bold"),
panel.grid.minor = element_blank())
ggsave("graficos_covid/03_analisis_central.png", grafico_central,
width = 15, height = 9, dpi = 300, bg = "white")
print(">>> Gráfico 3 generado. Colores: C1=Morado, C2=Verde.")
# ----------------------------------------------------------------------------
# GRÁFICO 3: ANÁLISIS CENTRAL
# ----------------------------------------------------------------------------
print(">>> Generando Gráfico 3: Regresión Final...")
# 1. DEFINICIÓN DE COLORES (Tu mapa visual confirmado)
# C1=Morado, C2=Verde, C3=Rojo, C4=Gris, C5=Azul
colores_sincronizados <- c("#8E44AD", "#27AE60", "#E74C3C", "#34495E", "#3498DB")
# 2. ETIQUETAS DE LEYENDA (Ajustadas a tu análisis)
etiquetas_clusters <- c(
"C1: Occidente/Viejos (Alta Mort.)",
"C2: Jóvenes/Desarrollo (Baja Mort.)",
"C3: Bloque Mayoritario",
"C4: Ricos/Anglo (Impacto Medio)",
"C5: Outlier (Singapore)"
)
# 3. PAÍSES A DESTACAR (Selección estratégica para cubrir todo el gráfico)
paises_vip <- c(
# C1 (Morado): El epicentro
"Spain", "Italy", "Belgium", "Peru", "United Kingdom",
# C2 (Verde): El escudo joven
"Nigeria", "Tanzania", "Yemen", "Afghanistan",
# C3 (Rojo): Los grandes emergentes
"Brazil", "India", "Mexico",
# C4 (Gris): Comparativa de gestión (Estricto vs Laxo)
"United States", "Sweden", "Australia",
# C5 (Azul): El caso raro
"Singapore"
)
datos_vip <- datos_paises[datos_paises$Pais %in% paises_vip, ]
# 4. CALCULAR PENDIENTE
modelo <- lm(Muertes_Millon ~ Rigurosidad_Media, data = datos_paises)
pendiente <- round(coef(modelo)[2], 2)
# 5. GENERAR GRÁFICO
grafico_central <- ggplot(datos_paises, aes(x = Rigurosidad_Media, y = Muertes_Millon)) +
# Puntos
geom_point(aes(color = Grupo_Cluster), size = 4.5, alpha = 0.8) +
# Línea de tendencia
geom_smooth(method = "lm", se = TRUE, color = "#E67E22",
fill = "#E67E22", alpha = 0.15, linetype = "dashed", size = 1.2) +
# Etiquetas de países (ggrepel colocará las etiquetas para que no se pisen)
geom_text_repel(data = datos_vip,
aes(label = Pais),
size = 3.8, fontface = "bold", color = "#2C3E50",
box.padding = 0.6, max.overlaps = 50, point.padding = 0.3) +
# TUS COLORES Y NOMBRES
scale_color_manual(values = colores_sincronizados,
labels = etiquetas_clusters,
name = "Perfiles Demográficos") +
# NOTAS EXPLICATIVAS ACTUALIZADAS
annotate("text", x = min(datos_paises$Rigurosidad_Media),
y = max(datos_paises$Muertes_Millon),
label = paste0("Paradoja: Pendiente +", pendiente),
color = "#C0392B", size = 5, fontface = "bold", hjust = 0) +
annotate("label", x = 50, y = -500,
label = "CLAVES VISUALES:\n• Puntos morados (C1): Zona central superior. Alta mortalidad pese a medidas relativamente estrictas.\n• Puntos verdes (C2): Zona inferior izquierda. Mínima mortalidad por factor juventud.\n• Sweden vs United States (Gris): Mortalidades similares, a pesar de estrategias opuestas.",
color = "gray20", size = 3.2, fontface = "italic", fill = "#ECF0F1", label.size = 0) +
# Títulos
labs(title = "¿Sirvió la 'Mano Dura'? Rigurosidad vs. Mortalidad",
subtitle = "Análisis de 150 países: La demografía fue más determinante que las restricciones",
x = "Índice de Rigurosidad Promedio (0-100)",
y = "Muertes Totales por Millón") +
theme_minimal(base_size = 14) +
theme(plot.title = element_text(face = "bold", size = 18, hjust = 0.5, color = "#2C3E50"),
plot.subtitle = element_text(size = 12, hjust = 0.5, color = "gray50"),
legend.position = "right",
legend.title = element_text(face = "bold"),
panel.grid.minor = element_blank())
ggsave("graficos_covid/03_analisis_central.png", grafico_central,
width = 15, height = 9, dpi = 300, bg = "white")
print(">>> Gráfico 3 generado. Colores: C1=Morado, C2=Verde.")
# ----------------------------------------------------------------------------
# GRÁFICO 3: ANÁLISIS CENTRAL
# ----------------------------------------------------------------------------
print(">>> Generando Gráfico 3: Regresión Final...")
# 1. DEFINICIÓN DE COLORES
# C1=Morado, C2=Verde, C3=Rojo, C4=Gris, C5=Azul
colores_sincronizados <- c("#8E44AD", "#27AE60", "#E74C3C", "#34495E", "#3498DB")
# 2. ETIQUETAS DE LEYENDA
etiquetas_clusters <- c(
"C1: Occidente/Viejos (Alta Mort.)",
"C2: Jóvenes/Desarrollo (Baja Mort.)",
"C3: Bloque Mayoritario",
"C4: Ricos/Anglo (Impacto Medio)",
"C5: Outlier (Singapore)"
)
# 3. PAÍSES A DESTACAR PARA CUBRIR TODO EL GRÁFICO
paises_vip <- c(
# C1 (Morado): El epicentro
"Spain", "Italy", "Belgium", "Peru", "United Kingdom",
# C2 (Verde): El escudo joven
"Tanzania", "Yemen", "Afghanistan",
# C3 (Rojo): Los grandes emergentes
"Brazil", "India", "Mexico",
# C4 (Gris): Comparativa de gestión (Estricto vs Laxo)
"United States", "Sweden", "Australia",
# C5 (Azul): El caso raro
"Singapore"
)
datos_vip <- datos_paises[datos_paises$Pais %in% paises_vip, ]
# 4. CALCULAR PENDIENTE
modelo <- lm(Muertes_Millon ~ Rigurosidad_Media, data = datos_paises)
pendiente <- round(coef(modelo)[2], 2)
# 5. GENERAR GRÁFICO
grafico_central <- ggplot(datos_paises, aes(x = Rigurosidad_Media, y = Muertes_Millon)) +
# Puntos
geom_point(aes(color = Grupo_Cluster), size = 4.5, alpha = 0.8) +
# Línea de tendencia
geom_smooth(method = "lm", se = TRUE, color = "#E67E22",
fill = "#E67E22", alpha = 0.15, linetype = "dashed", size = 1.2) +
# Etiquetas de países (ggrepel para que las etiquetas no se superpongan)
geom_text_repel(data = datos_vip,
aes(label = Pais),
size = 3.8, fontface = "bold", color = "#2C3E50",
box.padding = 0.6, max.overlaps = 50, point.padding = 0.3) +
scale_color_manual(values = colores_sincronizados,
labels = etiquetas_clusters,
name = "Perfiles Demográficos") +
# Notas explicativas
annotate("text", x = min(datos_paises$Rigurosidad_Media),
y = max(datos_paises$Muertes_Millon),
label = paste0("Paradoja: Pendiente +", pendiente),
color = "#C0392B", size = 5, fontface = "bold", hjust = 0) +
annotate("label", x = 50, y = -500,
label = "CLAVES VISUALES:\n• Puntos morados (C1): Zona central superior. Alta mortalidad pese a medidas relativamente estrictas.\n• Puntos verdes (C2): Zona inferior izquierda. Mínima mortalidad por factor juventud.\n• Sweden vs United States (Gris): Mortalidades similares, a pesar de estrategias opuestas.",
color = "gray20", size = 3.2, fontface = "italic", fill = "#ECF0F1", label.size = 0) +
# Títulos
labs(title = "¿Sirvió la 'Mano Dura'? Rigurosidad vs. Mortalidad",
subtitle = "Análisis de 150 países: La demografía fue más determinante que las restricciones",
x = "Índice de Rigurosidad Promedio (0-100)",
y = "Muertes Totales por Millón") +
theme_minimal(base_size = 14) +
theme(plot.title = element_text(face = "bold", size = 18, hjust = 0.5, color = "#2C3E50"),
plot.subtitle = element_text(size = 12, hjust = 0.5, color = "gray50"),
legend.position = "right",
legend.title = element_text(face = "bold"),
panel.grid.minor = element_blank())
ggsave("graficos_covid/03_analisis_central.png", grafico_central,
width = 15, height = 9, dpi = 300, bg = "white")
print(">>> Gráfico generado: 03_analisis_central.png")
# --- CONFIGURACIÓN INICIAL ---
# Ajustar directorio de trabajo (comentar o cambiar según el ordenador donde se ejecute)
setwd("D:/CUARTO/AMD/PRACTICA2/p2_LuciaVazquez/fuentes/transformacion_datos/tablas_resultado")
# Carga y limpieza preliminar
datos <- read.csv("vuelos.csv", na.strings = "")
datos <- na.omit(datos) # Eliminamos registros incompletos
# --- EJERCICIO 1: SELECCIÓN DEL MEJOR SUBCONJUNTO ---
# Objetivo: Encontrar el mejor modelo lineal probando combinaciones de 1 a 7 variables.
variables <- c("id_aerolinea", "id_operadora", "id_aeropuerto_origen",
"id_aeropuerto_destino", "id_avion", "distancia_km", "id_hora")
resultados <- data.frame()
# Bucle principal: iteramos por tamaño del subconjunto (de 1 a 7 variables)
for (p in 1:length(variables)) {
# Generamos todas las combinaciones posibles de tamaño p
combinaciones <- combn(variables, p, simplify = FALSE)
for (combo in combinaciones) {
# Construcción dinámica de la fórmula para el modelo lineal
formula_str <- paste("retardo_minutos ~", paste(combo, collapse = "+"))
# Ajuste del modelo
modelo <- lm(as.formula(formula_str), data = datos)
# Extraer métricas (Summary, AIC, BIC)
s <- summary(modelo)
r2_adj <- s$adj.r.squared
aic_val <- AIC(modelo)
bic_val <- BIC(modelo)
# Guardar en la tabla
resultados <- rbind(resultados, data.frame(
Num_Variables = p,
Variables = paste(combo, collapse = " + "),
R2_Ajustado = r2_adj,
AIC = aic_val,
BIC = bic_val
))
}
}
# Selección del mejor modelo para cada tamaño (Criterio: Mínimo AIC)
mejores_modelos <- data.frame()
for (i in 1:length(variables)) {
subgrupo <- resultados[resultados$Num_Variables == i, ]
mejor <- subgrupo[which.min(subgrupo$AIC), ]
mejores_modelos <- rbind(mejores_modelos, mejor)
}
# Resultados Ejercicio 1
print("--- COMPARATIVA DE LOS MEJORES MODELOS (p=1 hasta 7) ---")
print(mejores_modelos[, c("Num_Variables", "R2_Ajustado", "AIC", "BIC")])
print("--- EL MEJOR MODELO DE TODOS (Menor AIC) ---")
mejor_global <- resultados[which.min(resultados$AIC), ]
print(mejor_global)
# --- EJERCICIO 2: CLASIFICACIÓN (K-MEANS) Y VISUALIZACIÓN ---
# Diccionarios para mapear IDs a Nombres Reales en las gráficas
dict_aeropuertos <- c("1"="Abilene Regional", "235"="Palm Beach Intl", "191"="Midland Regional")
dict_aerolineas  <- c("7"="JetBlue Airways", "14"="Southwest Airlines", "3"="Delta Air Lines")
dict_aviones     <- c("545"="Airbus Industrie", "55"="Boeing Co.", "539"="Embraer")
# Configuración del layout gráfico (2 columnas de gráficos + 1 columna leyenda)
m <- matrix(c(1, 2, 5,
3, 4, 5), nrow = 2, byrow = TRUE)
layout(m, widths = c(1, 1, 0.5))
# Análisis previo para Tracking: Identificamos aeropuertos de referencia (mejor, medio, peor)
# para ver su comportamiento tanto en origen como en destino
media_origen <- aggregate(retardo_minutos ~ id_aeropuerto_origen, data = datos, FUN = mean)
media_origen <- media_origen[order(media_origen$retardo_minutos), ]
id_bueno <- media_origen$id_aeropuerto_origen[1]                           # Mejor
id_medio <- media_origen$id_aeropuerto_origen[round(nrow(media_origen)/2)] # Bueno
id_malo  <- media_origen$id_aeropuerto_origen[nrow(media_origen)]          # Peor
ids_rastreo <- c(id_bueno, id_medio, id_malo)
# Función para generar los gráficos de clasificación
grafico_final_pulido <- function(df, columna, titulo, ids_fijos = NULL) {
# 1. Agregación: media de retraso por entidad
form <- as.formula(paste("retardo_minutos ~", columna))
medias <- aggregate(form, data = df, FUN = mean)
# 2. Clustering: K-Means con k=3 (Bajo, Medio, Alto)
set.seed(123)
km <- kmeans(medias$retardo_minutos, centers = 3)
medias$Grupo <- km$cluster
# 3. Asignación de colores según severidad (Verde -> Naranja -> Rojo)
info <- aggregate(retardo_minutos ~ Grupo, data = medias, FUN = mean)
ranking <- order(info$retardo_minutos)
colores <- rep(NA, 3)
colores[ranking] <- c("green3", "orange", "red")
medias$Color <- colores[medias$Grupo]
medias <- medias[order(medias$retardo_minutos), ]
# 4. Graficado
n_puntos <- nrow(medias)
# Ajuste de límites para que quepan las etiquetas
limite_x <- c(1 - (n_puntos * 0.08), n_puntos + (n_puntos * 0.08))
y_max <- max(medias$retardo_minutos) * 1.25
par(mar = c(3, 4, 3, 1)) # Márgenes
plot(1:n_puntos, medias$retardo_minutos,
pch = 19, col = medias$Color, type = "o", lwd = 1,
xlim = limite_x, ylim = c(0, y_max),
main = titulo, ylab = "Retraso (min)", xlab = "",
cex.main = 1, xaxt = "n", las = 1)
title(xlab = "Entidades", line = 1, cex.lab = 0.9)
grid()
# 5. Etiquetado inteligente (Tracking vs Automático)
if (!is.null(ids_fijos)) {
# Si hay IDs fijos (aeropuertos), buscamos esos índices
filas <- which(medias[[columna]] %in% ids_fijos)
idx_puntos <- if(length(filas)>0) filas else c(1, n_puntos) # Fallback
} else {
# Si no, etiquetamos el mejor, el del medio y el peor
idx_puntos <- c(1, round(n_puntos/2), n_puntos)
}
ids_reales <- medias[[columna]][idx_puntos]
# Mapeo de nombres usando los diccionarios
diccionario_uso <- NULL
if (grepl("aeropuerto", columna)) diccionario_uso <- dict_aeropuertos
else if (grepl("aerolinea", columna)) diccionario_uso <- dict_aerolineas
else if (grepl("avion", columna))     diccionario_uso <- dict_aviones
etiquetas <- sapply(ids_reales, function(id) {
id_char <- as.character(id)
if (!is.null(diccionario_uso) && id_char %in% names(diccionario_uso)) {
return(diccionario_uso[id_char])
} else { return(paste("ID:", id)) }
})
# Ajuste de posición del texto para evitar solapamientos
posiciones <- rep(3, length(idx_puntos)) # Todos arriba
offsets <- rep(1, length(idx_puntos))
# Alejar un poco más la etiqueta del primer punto (el más bajo)
offsets[idx_puntos == 1] <- 1.5
for(i in seq_along(idx_puntos)) {
text(x = idx_puntos[i],
y = medias$retardo_minutos[idx_puntos[i]],
labels = etiquetas[i],
pos = posiciones[i],
cex = 0.85,
font = 2,
offset = offsets[i])
}
}
# Generación de los 4 gráficos
grafico_final_pulido(datos, "id_aeropuerto_origen", "Aeropuerto Origen", ids_fijos = ids_rastreo)
grafico_final_pulido(datos, "id_aeropuerto_destino", "Aeropuerto Destino", ids_fijos = ids_rastreo)
grafico_final_pulido(datos, "id_aerolinea", "Aerolínea", ids_fijos = NULL)
grafico_final_pulido(datos, "id_avion", "Avión", ids_fijos = NULL)
# Leyenda lateral común
par(mar = c(0, 0, 0, 0))
plot(1, type = "n", axes = FALSE, xlab = "", ylab = "")
legend("left", legend = c("Bajo", "Medio", "Alto"),
col = c("green3", "orange", "red"), pch = 19, pt.cex = 2,
title = "LEYENDA", title.adj = 0.1, bty = "o", bg = "white", cex = 1,
inset = 0.05, x.intersp = 0.6, y.intersp = 1.5)
par(mfrow = c(1, 1))
